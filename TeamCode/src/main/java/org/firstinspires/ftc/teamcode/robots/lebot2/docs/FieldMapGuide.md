# FieldMap Guide

A quick reference for defining waypoints and building autonomous trajectories.

---

## Adding New Waypoints

### Step 1: Add to RED_WAYPOINTS map

Open `FieldMap.java` and add your waypoint in the `static` block:

```java
static {
    // ... existing waypoints ...

    // Add your new waypoint (RED alliance coordinates)
    RED_WAYPOINTS.put("MY_NEW_WAYPOINT", new Waypoint(24.0, -48.0, 135.0));
    //                                               x(in)  y(in)  heading(deg)
}
```

**Coordinate system (DECODE):**
- X+ toward audience
- Y- is red side, Y+ is blue side
- Heading 0° = facing audience, 90° = facing blue wall, -90° = facing red wall

### Step 2: Add a constant (optional but recommended)

At the bottom of `FieldMap.java`, add a constant to avoid typos:

```java
public static final String MY_NEW_WAYPOINT = "MY_NEW_WAYPOINT";
```

### Step 3: Use it

```java
Pose2d pose = FieldMap.getPose(FieldMap.MY_NEW_WAYPOINT, Robot.isRedAlliance);
```

The blue alliance version is auto-generated by reflecting across the X axis.

---

## Quick Runtime Additions

For testing without recompiling:

```java
// Add a temporary waypoint
FieldMap.addWaypoint("TEST_POINT", 36.0, -24.0, 90.0);

// Use it immediately
Pose2d testPose = FieldMap.getPose("TEST_POINT", true);
```

---

## Building Trajectories

### Basic lineTo Trajectory

```java
// Get waypoints for current alliance
Pose2d start = FieldMap.getPose(FieldMap.START_AUDIENCE, Robot.isRedAlliance);
Pose2d fire1 = FieldMap.getPose(FieldMap.FIRE_1, Robot.isRedAlliance);

// Build trajectory
TrajectoryActionBuilder builder = driveTrain.actionBuilder(start);
Action driveToFire = builder
    .lineToX(fire1.position.x)  // Drive forward/backward to X
    .build();
```

### Driving to a Position (lineToXConstantHeading / lineToYConstantHeading)

For tank drive, use constant heading variants to maintain orientation:

```java
Pose2d fire1 = FieldMap.getPose(FieldMap.FIRE_1, Robot.isRedAlliance);

// Drive to X position, keeping current heading
Action moveX = driveTrain.actionBuilder(currentPose)
    .lineToXConstantHeading(fire1.position.x)
    .build();

// Drive to Y position, keeping current heading
Action moveY = driveTrain.actionBuilder(currentPose)
    .lineToYConstantHeading(fire1.position.y)
    .build();
```

### Multi-Waypoint Sequence

```java
Pose2d start = FieldMap.getPose(FieldMap.START_AUDIENCE, Robot.isRedAlliance);
Pose2d fire1 = FieldMap.getPose(FieldMap.FIRE_1, Robot.isRedAlliance);
Pose2d ballRow1 = FieldMap.getPose(FieldMap.BALL_ROW_1_START, Robot.isRedAlliance);
Pose2d ballRow1End = FieldMap.getPose(FieldMap.BALL_ROW_1_END, Robot.isRedAlliance);
Pose2d fire2 = FieldMap.getPose(FieldMap.FIRE_2, Robot.isRedAlliance);

Action sequence = driveTrain.actionBuilder(start)
    // Drive to first fire position
    .lineToX(fire1.position.x)
    .stopAndAdd(launchAction)  // Fire balls

    // Drive to ball row
    .lineToX(ballRow1.position.x)
    .turnTo(ballRow1.heading)  // Face the row

    // Drive through ball row (collecting balls)
    .lineToX(ballRow1End.position.x)

    // Return to fire position
    .turnTo(fire2.heading)
    .lineToX(fire2.position.x)
    .stopAndAdd(launchAction)  // Fire again

    .build();
```

### Turn to Face a Heading

```java
Waypoint wp = FieldMap.get(FieldMap.FIRE_1, Robot.isRedAlliance);

// Turn to the waypoint's heading
Action turn = driveTrain.actionBuilder(currentPose)
    .turnTo(Math.toRadians(wp.heading))  // Waypoint heading is in degrees
    .build();

// Or use Pose2d directly (heading already in radians)
Pose2d firePose = FieldMap.getPose(FieldMap.FIRE_1, Robot.isRedAlliance);
Action turn2 = driveTrain.actionBuilder(currentPose)
    .turnTo(firePose.heading)
    .build();
```

---

## Common Patterns

### Drive Forward to X, Then Turn

```java
Pose2d target = FieldMap.getPose(FieldMap.FIRE_1, Robot.isRedAlliance);

Action driveAndTurn = driveTrain.actionBuilder(currentPose)
    .lineToXConstantHeading(target.position.x)
    .turnTo(target.heading)
    .build();
```

### Ball Collection Run

```java
Pose2d rowStart = FieldMap.getPose(FieldMap.BALL_ROW_1_START, Robot.isRedAlliance);
Pose2d rowEnd = FieldMap.getPose(FieldMap.BALL_ROW_1_END, Robot.isRedAlliance);

Action collectBalls = driveTrain.actionBuilder(currentPose)
    // Navigate to row start
    .lineToX(rowStart.position.x)
    .turnTo(rowStart.heading)

    // Drive slowly through the row
    .lineToXConstantHeading(rowEnd.position.x)  // Intake runs during this
    .build();
```

### Return to Homebase

```java
Pose2d home = FieldMap.getPose(FieldMap.HOMEBASE, Robot.isRedAlliance);

Action goHome = driveTrain.actionBuilder(currentPose)
    .lineToX(home.position.x)
    .turnTo(home.heading)
    .build();
```

---

## Tips

1. **Measure waypoints with the robot** - Drive to position manually, read pose from telemetry, copy values to FieldMap.

2. **Test one waypoint at a time** - Verify each waypoint is correct before building complex sequences.

3. **Use constants** - `FieldMap.FIRE_1` catches typos at compile time, `"FIRE_1"` doesn't.

4. **Heading units matter:**
   - `Waypoint.heading` is in **degrees**
   - `Pose2d.heading` is in **radians**
   - `turnTo()` expects **radians**

5. **Alliance reflection** - Only define red waypoints. Blue is automatic. If a waypoint looks wrong for blue, check your red Y-coordinate sign.
